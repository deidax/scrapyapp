version: '3'
services:
  ###
  # services
  ###
    django-app:
        build: .
        # command: python manage.py runserver 0.0.0.0:8000
        container_name: django_server
        environment: 
            - SECRET_KEY=sigma274ing@dwEtRusT#
        volumes:
            - static:/static
        ports:
            - "8000:8000"
        depends_on:
            - scrapyd-service
        networks:
            - backend
    scrapyd-service:
        build:
            context: app
            dockerfile: ./Dockerfile
        # dockerfile: ./scrapy_app/Dockerfile
        container_name: scrapyd_server
        ports:
            - "6800:6800"
        networks:
            - backend
        # deploy:
        #     resources:
        #         limits:
        #             cpus: "2"
        #             memory: 2G
    nginx:
        build: app/nginx
        volumes: 
            - static:/static
        ports: 
            - "80:80"
        depends_on:
            - django-app
        networks: 
            - backend 
networks:
    backend:
        driver: bridge
volumes: 
    static:

# volumes: 
#     static:
#         driver: azure_file
#         driver_opts: 
#             share_name: static
#             storage_account_name: az-khl-strorage
